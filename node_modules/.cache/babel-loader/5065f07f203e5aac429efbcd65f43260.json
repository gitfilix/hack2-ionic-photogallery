{"ast":null,"code":"import _toConsumableArray from\"/Users/rubendiaz/projects/hackaton/hack2-ionic-photogallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/rubendiaz/projects/hackaton/hack2-ionic-photogallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"/Users/rubendiaz/projects/hackaton/hack2-ionic-photogallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"/Users/rubendiaz/projects/hackaton/hack2-ionic-photogallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/rubendiaz/projects/hackaton/hack2-ionic-photogallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from\"react\";import{isPlatform}from\"@ionic/react\";import{Filesystem,Directory}from\"@capacitor/filesystem\";import{Camera,CameraResultType,CameraSource}from'@capacitor/camera';import{Storage}from'@capacitor/storage';import{Capacitor}from'@capacitor/core';var PHOTO_STORAGE=\"photos\";export function usePhotoGallery(){// useSteate \nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),photos=_useState2[0],setPhotos=_useState2[1];useEffect(function(){// async call Storage.get all photos\nvar loadSaved=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Storage$get,value,photosInStorage,_iterator,_step,photo,file;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Storage.get({key:PHOTO_STORAGE});case 2:_yield$Storage$get=_context.sent;value=_yield$Storage$get.value;// parse if there are pictures or return empty array\nphotosInStorage=value?JSON.parse(value):[];// If running on the web...\nif(isPlatform('hybrid')){_context.next=25;break;}_iterator=_createForOfIteratorHelper(photosInStorage);_context.prev=7;_iterator.s();case 9:if((_step=_iterator.n()).done){_context.next=17;break;}photo=_step.value;_context.next=13;return Filesystem.readFile({path:photo.filepath,directory:Directory.Data});case 13:file=_context.sent;// Web platform only: Load the photo as base64 data\nphoto.webviewPath=\"data:image/jpeg;base64,\".concat(file.data);case 15:_context.next=9;break;case 17:_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](7);_iterator.e(_context.t0);case 22:_context.prev=22;_iterator.f();return _context.finish(22);case 25:setPhotos(photosInStorage);case 26:case\"end\":return _context.stop();}}},_callee,null,[[7,19,22,25]]);}));return function loadSaved(){return _ref.apply(this,arguments);};}();loadSaved();},[]);var takePhoto=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var cameraPhoto,fileName,savedFileImage,newPhotos;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return Camera.getPhoto({resultType:CameraResultType.Uri,source:CameraSource.Camera,quality:95});case 2:cameraPhoto=_context2.sent;// unique file names \nfileName=new Date().getTime()+'.jpeg';// Array with stored images \n_context2.next=6;return savePicture(cameraPhoto,fileName);case 6:savedFileImage=_context2.sent;// newly taken Photos should be updated and stored \nnewPhotos=[savedFileImage].concat(_toConsumableArray(photos));setPhotos(newPhotos);Storage.set({key:PHOTO_STORAGE,value:JSON.stringify(newPhotos)});case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function takePhoto(){return _ref2.apply(this,arguments);};}();var savePicture=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(photo,fileName){var base64Data,file,savedFile;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!isPlatform('hybrid')){_context3.next=7;break;}_context3.next=3;return Filesystem.readFile({path:photo.path});case 3:file=_context3.sent;base64Data=file.data;_context3.next=10;break;case 7:_context3.next=9;return base64FromPath(photo.webPath);case 9:base64Data=_context3.sent;case 10:_context3.next=12;return Filesystem.writeFile({path:fileName,data:base64Data,directory:Directory.Data});case 12:savedFile=_context3.sent;if(!isPlatform('hybrid')){_context3.next=17;break;}return _context3.abrupt(\"return\",{filepath:savedFile.uri,webviewPath:Capacitor.convertFileSrc(savedFile.uri)});case 17:return _context3.abrupt(\"return\",{filepath:fileName,webviewPath:photo.webPath});case 18:case\"end\":return _context3.stop();}}},_callee3);}));return function savePicture(_x,_x2){return _ref3.apply(this,arguments);};}();// photo taken by the user should not be stored 'use case: ugly'\nvar deletePhoto=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(photo){var newPhotos,filename;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// Remove this photo from the Photos reference data array\nnewPhotos=photos.filter(function(p){return p.filepath!==photo.filepath;});// Update photos array cache by overwriting the existing photo array\nStorage.set({key:PHOTO_STORAGE,value:JSON.stringify(newPhotos)});// delete photo file from filesystem\nfilename=photo.filepath.substr(photo.filepath.lastIndexOf('/')+1);_context4.next=5;return Filesystem.deleteFile({path:filename,directory:Directory.Data});case 5:setPhotos(newPhotos);case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function deletePhoto(_x3){return _ref4.apply(this,arguments);};}();return{deletePhoto:deletePhoto,photos:photos,takePhoto:takePhoto};}export function base64FromPath(_x4){return _base64FromPath.apply(this,arguments);}function _base64FromPath(){_base64FromPath=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(path){var response,blob;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return fetch(path);case 2:response=_context5.sent;_context5.next=5;return response.blob();case 5:blob=_context5.sent;return _context5.abrupt(\"return\",new Promise(function(resolve,reject){var reader=new FileReader();reader.onerror=reject;reader.onload=function(){if(typeof reader.result==='string'){resolve(reader.result);}else{reject('method did not return a string');}};reader.readAsDataURL(blob);}));case 7:case\"end\":return _context5.stop();}}},_callee5);}));return _base64FromPath.apply(this,arguments);}","map":{"version":3,"sources":["/Users/rubendiaz/projects/hackaton/hack2-ionic-photogallery/src/hooks/usePhotoGallery.ts"],"names":["useState","useEffect","isPlatform","Filesystem","Directory","Camera","CameraResultType","CameraSource","Storage","Capacitor","PHOTO_STORAGE","usePhotoGallery","photos","setPhotos","loadSaved","get","key","value","photosInStorage","JSON","parse","photo","readFile","path","filepath","directory","Data","file","webviewPath","data","takePhoto","getPhoto","resultType","Uri","source","quality","cameraPhoto","fileName","Date","getTime","savePicture","savedFileImage","newPhotos","set","stringify","base64Data","base64FromPath","webPath","writeFile","savedFile","uri","convertFileSrc","deletePhoto","filter","p","filename","substr","lastIndexOf","deleteFile","fetch","response","blob","Promise","resolve","reject","reader","FileReader","onerror","onload","result","readAsDataURL"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { isPlatform } from \"@ionic/react\";\nimport { Filesystem, Directory } from \"@capacitor/filesystem\"\nimport { Camera, CameraResultType, CameraSource, Photo } from '@capacitor/camera';\nimport { Storage } from '@capacitor/storage'\nimport { Capacitor } from '@capacitor/core';\n\nconst PHOTO_STORAGE = \"photos\";\n\nexport interface UserPhoto {\n  filepath: string;\n  webviewPath?: string;\n}\n\nexport function usePhotoGallery() {\n  // useSteate \n  const [photos, setPhotos] = useState<UserPhoto[]>([]);\n\n  useEffect(() => {\n    // async call Storage.get all photos\n    const loadSaved = async () => {\n      const { value } = await Storage.get({ key: PHOTO_STORAGE });\n      // parse if there are pictures or return empty array\n      const photosInStorage = (value ? JSON.parse(value) : []) as UserPhoto[];\n      // If running on the web...\n      if (!isPlatform('hybrid')) {\n        for (let photo of photosInStorage) {\n          const file = await Filesystem.readFile({\n            path: photo.filepath,\n            directory: Directory.Data\n          });\n          // Web platform only: Load the photo as base64 data\n          photo.webviewPath = `data:image/jpeg;base64,${file.data}`;\n        }\n      }\n      setPhotos(photosInStorage);\n    };\n    loadSaved();\n  }, []);\n\n  const takePhoto = async () => {\n    // take a new photo: generic Camera.getPhoto from Capacitor method\n    const cameraPhoto = await Camera.getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 95\n    });\n    // unique file names \n    const fileName = new Date().getTime() + '.jpeg';\n    // Array with stored images \n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    // newly taken Photos should be updated and stored \n    const newPhotos = [savedFileImage, ...photos];\n    setPhotos(newPhotos);\n    Storage.set({ key: PHOTO_STORAGE, value: JSON.stringify(newPhotos) });\n  };\n\n  const savePicture = async (photo: Photo, fileName: string): Promise<UserPhoto> => {\n    let base64Data: string;\n    // platform hybrid will detect Cordova or Capacitor;\n    if (isPlatform('hybrid')) {\n      const file = await Filesystem.readFile({\n        path: photo.path!\n      });\n      base64Data = file.data;\n    } else {\n      base64Data = await base64FromPath(photo.webPath!);\n    }\n    const savedFile = await Filesystem.writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: Directory.Data\n    });\n\n    if (isPlatform('hybrid')) {\n      // Display the new image by rewriting the 'file://' path to 'HTTP'\n      // Details: https://ionicframework.com/docs/building/webview#file-protocol\n      // Capacitonr convertFile convert file URIs\n      return {\n        filepath: savedFile.uri,\n        webviewPath: Capacitor.convertFileSrc(savedFile.uri),\n      };\n    }\n    else {\n      // Use webPath to display the new image instead of base64 since it's\n      // already loaded into memory\n      return {\n        filepath: fileName,\n        webviewPath: photo.webPath\n      };\n    }\n  };\n\n  // photo taken by the user should not be stored 'use case: ugly'\n  const deletePhoto = async (photo: UserPhoto) => {\n    // Remove this photo from the Photos reference data array\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath);\n\n    // Update photos array cache by overwriting the existing photo array\n    Storage.set({ key: PHOTO_STORAGE, value: JSON.stringify(newPhotos) });\n\n    // delete photo file from filesystem\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\n    await Filesystem.deleteFile({\n      path: filename,\n      directory: Directory.Data\n    });\n    setPhotos(newPhotos);\n  };\n\n  return {\n    deletePhoto,\n    photos,\n    takePhoto\n  };\n}\n\nexport async function base64FromPath(path: string): Promise<string> {\n  const response = await fetch(path);\n  const blob = await response.blob();\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = reject;\n    reader.onload = () => {\n      if (typeof reader.result === 'string') {\n        resolve(reader.result);\n      } else {\n        reject('method did not return a string')\n      }\n    };\n    reader.readAsDataURL(blob);\n  });\n}\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}